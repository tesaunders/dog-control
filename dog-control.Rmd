---
title: "Dog Management in Auckland"
author: "Tom Saunders"
output: html_document
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = file.path(dirname(inputFile), 'index.html')) })
bibliography: references.bib
csl: style.csl
---

Under the Dog Control Act 1996[@anonymous1996] local territorial authorities are responsible for enacting and enforcing bylaws designed to minimise the danger and nuisance caused by dogs to the public. The Act also requires local authorities to report statistics and data relating to dog control activities. Auckland Council operates a regional Animal Management unit and provides data relating to it's activities within [annual reports](https://www.aucklandcouncil.govt.nz/plans-projects-policies-reports-bylaws/our-policies/Pages/policy-on-dogs.aspx).

I have compiled a dataset relating to dog control taken from these annual reports starting in 2014. The complete dataset, and R code used to perform all the analyses, is available [here](https://github.com/tesaunders/dog-control).

```{r, echo=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
```

```{r, echo=FALSE, message=FALSE}
dog_data <- read_csv("data/dog-control.csv")
```

```{r, echo=FALSE}
# Summaries of dogs and owners

dogs <- dog_data |> 
  filter(category == "registrations" | category == "classification") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  select(-dangerous_total, -(starts_with("shelters"))) |> 
  mutate(
    menacing = menacing_33A + menacing_33C,
    dangerous = dangerous_conviction + dangerous_evidence + dangerous_admission,
    pc_men = menacing / dogs_known,
    pc_dan = dangerous / dogs_known,
    pc_reg = dogs_registered / dogs_known,
  )

owners <- dog_data |> 
  filter(subcategory == "owners" | subcategory == "prosecution-appeal") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    owners_sanctioned = owners_probationary + owners_disqualified,
    pc_sanctioned = owners_sanctioned / owners_total,
  )
```

## Dogs {.tabset}

### Number of Dogs

The number of known dogs has increased dramatically since 2020, while the drop in 2018 reflects work to remove duplicate entries from the register in 2017.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = dogs_known)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Registrations

The proportion of dogs registered has started to fall sharply since 2020.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_reg)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Menacing Dogs

Meanwhile, the proportion of dogs classified as menacing has more than doubled since 2014.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_men)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Owners {.tabset}

### Number of Owners

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = owners_total)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Sanctioned Owners

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = pc_sanctioned)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

The rise in dog ownership since 2020 has been attributed to the increased time many people spent at home during COVID-19 lockdowns. A nation-wide lockdown was enacted in late March for 2 months, followed by regionalised lockdowns for Auckland in August–September 2020 and February–March 2021. Veterinary de-sexing services were unable to operate...WIP

While the *number* of sanctioned owners would be expected to rise in line with the increase in owners, it is concerning that the *proportion* of owners classified as probationary or disqualified is also increasing.

## Responses {.tabset}

### Responses over time

```{r, echo=FALSE, message=FALSE}
rfs <- dog_data |> 
  filter(subcategory == "priority-1" | 
           subcategory == "priority-2") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value) |> 
  mutate(
    rfs_total = `priority-1` + `priority-2`,
  )

ggplot(rfs, aes(x = financial_year)) +
  geom_smooth(aes(y = rfs_total, color = "Total"), se = FALSE, linewidth = 0.8) +
  geom_smooth(aes(y = `priority-1`, color = "Priority 1"), se = FALSE, linewidth = 0.8) +
  scale_color_manual(values = c(
    "Total" = "darkblue",
    "Priority 1" = "darkred")) +
  labs(color = "Response Type") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

##  {.unnumbered}

## Impounds {.tabset}

```{r, echo=FALSE}
impounds <- dog_data |> 
  filter(category == "shelters") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value)

impounds$dogs_known <- dogs$dogs_known

impounds <- impounds |> 
  mutate(
    pc_impounded = impound / dogs_known,
    pc_returned = `claimed-returned` / impound,
    pc_euthanised = euthanised / impound,
    pc_adopted = `adopted-rescued` / impound,
  )
```

### Impounded Dogs

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_impounded)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Claimed/Returned to Owner

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_returned)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Euthanised

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_euthanised)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Adopted/Rescued

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_adopted)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Enforcement {.tabset}

```{r, echo=FALSE}
enforce <- dog_data |> 
  filter(category == "enforcement" | category == "infringements") |>
  select(-category) |> 
  group_by(financial_year) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value)
```

### Infringement notices - total

```{r, echo=FALSE, message=FALSE}
ggplot(enforce, aes(x = financial_year, y = offence_total)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Prosecutions

```{r, echo=FALSE, message=FALSE}
ggplot(enforce, aes(x = financial_year, 
                   y = `prosecution-appeal_total`)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

##  {.unnumbered}

## Resourcing {.tabset}

```{r, echo=FALSE}
resource <- dog_data |> 
  filter(category == "resourcing") |>
  select(-category) |> 
  group_by(financial_year) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    pc_field = staff_field / staff_total,
  )

resource$dogs_known <- dogs$dogs_known

resource <- resource |> 
  mutate(
    staff_indexed = dogs_known / staff_total,
  )
```

### Staff vs Dogs

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(resource, aes(x = financial_year, 
                   y = staff_indexed)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### AMOs %

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(resource, aes(x = financial_year, 
                   y = pc_field)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## References
