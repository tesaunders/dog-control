---
title: "Dog Management in Auckland"
author: "Tom Saunders"
output: html_document
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = file.path(dirname(inputFile), 'index.html')) })
bibliography: references.bib
csl: style.csl
---

Under the Dog Control Act 1996[@anonymous1996] local territorial authorities are responsible for enacting and enforcing bylaws designed to minimise the danger and nuisance caused by dogs to the public. The Act also requires local authorities to report statistics and data relating to dog control activities. Auckland Council operates a regional Animal Management unit and provides data relating to it's activities within [annual reports](https://www.aucklandcouncil.govt.nz/plans-projects-policies-reports-bylaws/our-policies/Pages/policy-on-dogs.aspx).

The following analyses have been performed on a dataset compiled from data within these annual reports starting in 2014. The complete dataset, and R code used to perform all the analyses, is available [here](https://github.com/tesaunders/dog-control).

```{r load-packages, echo=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
```

```{r read-data, echo=FALSE, message=FALSE}
dog_data <- read_csv("data/dog-control.csv")
```

```{r summary-dogs, echo=FALSE}
dogs <- dog_data |> 
  filter(category == "registrations" | category == "classification") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  select(-dangerous_total, -(starts_with("shelters"))) |> 
  mutate(
    menacing = menacing_33A + menacing_33C,
    dangerous = dangerous_conviction + dangerous_evidence + dangerous_admission,
    pc_men = menacing / dogs_known,
    pc_dan = dangerous / dogs_known,
    pc_reg = dogs_registered / dogs_known,
  )
```

```{r summary-owners, echo=FALSE}
owners <- dog_data |> 
  filter(subcategory == "owners" | subcategory == "prosecution-appeal") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    owners_sanctioned = owners_probationary + owners_disqualified,
    pc_sanctioned = owners_sanctioned / owners_total,
  )
```

## Dogs {.tabset}

### Number of Dogs

The number of known dogs has increased dramatically since 2020, while the drop in 2018 reflects work to remove duplicate entries from the register in 2017.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = dogs_known)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Registrations

The proportion of dogs registered has started to fall sharply since 2020.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_reg)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Attacks {.tabset}

```{r, echo=FALSE, message=FALSE, warning=FALSE}
attacks <- dog_data |> 
  filter(category == "response") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    total_response = `priority-1_total` + `priority-2_total`,
    pc_attack_people = `type_attack-people` / total_response,
  )
```

### Attacks on People

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(attacks, aes(x = financial_year, y = pc_attack_people)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Aggression

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(attacks, aes(x = financial_year)) +
  geom_smooth(aes(y = `type_aggressive-people`, colour = "ag_people"), se = FALSE, linewidth = 0.8) +
  geom_smooth(aes(y = `type_attack-animals`, colour = "at_animals"), se = FALSE, linewidth = 0.8) +
  geom_smooth(aes(y = `type_aggressive-animals`, colour = "ag_animals"), se = FALSE, linewidth = 0.8) +
  scale_color_manual(values = c(
    "ag_people" = "darkred",
    "at_animals" = "orange",
    "ag_animals" = "yellow")) +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Menacing Dogs

The proportion of dogs classified as menacing has more than doubled since 2014.

```{r, echo=FALSE, message=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_men)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Owners {.tabset}

### Number of Owners

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = owners_total)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Sanctioned Owners

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = pc_sanctioned)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Responses {.tabset}

### Responses over time

```{r, echo=FALSE, message=FALSE}
rfs <- dog_data |> 
  filter(subcategory == "priority-1" | 
           subcategory == "priority-2") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value) |> 
  mutate(
    rfs_total = `priority-1` + `priority-2`,
  )

ggplot(rfs, aes(x = financial_year)) +
  geom_smooth(aes(y = rfs_total, color = "Total"), se = FALSE, linewidth = 0.8) +
  geom_smooth(aes(y = `priority-1`, color = "Priority 1"), se = FALSE, linewidth = 0.8) +
  scale_color_manual(values = c(
    "Total" = "darkblue",
    "Priority 1" = "darkred")) +
  labs(color = "Response Type") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

##  {.unnumbered}

## Impounds {.tabset}

```{r, echo=FALSE}
impounds <- dog_data |> 
  filter(category == "shelters") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value)

impounds$dogs_known <- dogs$dogs_known

impounds <- impounds |> 
  mutate(
    pc_impounded = impound / dogs_known,
    pc_returned = `claimed-returned` / impound,
    pc_euthanised = euthanised / impound,
    pc_adopted = `adopted-rescued` / impound,
  )
```

### Impounded Dogs

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_impounded)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Claimed/Returned to Owner

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_returned)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Euthanised

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_euthanised)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

### Adopted/Rescued

```{r, echo=FALSE, message=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_adopted)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Enforcement {.tabset}

```{r, echo=FALSE}
enforce <- dog_data |> 
  filter(category == "enforcement" | category == "infringements") |>
  select(-category) |> 
  group_by(financial_year) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value)
```

### Infringement notices - total

```{r, echo=FALSE, message=FALSE}
ggplot(enforce, aes(x = financial_year, y = offence_total)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Prosecutions

```{r, echo=FALSE, message=FALSE}
ggplot(enforce, aes(x = financial_year, 
                   y = `prosecution-appeal_total`)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

##  {.unnumbered}

## Resourcing {.tabset}

```{r, echo=FALSE}
resource <- dog_data |> 
  filter(category == "resourcing") |>
  select(-category) |> 
  group_by(financial_year) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    pc_field = staff_field / staff_total,
  )

resource$dogs_known <- dogs$dogs_known

resource <- resource |> 
  mutate(
    staff_indexed = dogs_known / staff_total,
  )
```

### Staff vs Dogs

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(resource, aes(x = financial_year, 
                   y = staff_indexed)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### AMOs %

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(resource, aes(x = financial_year, 
                   y = pc_field)) +
  geom_smooth(se = FALSE, linewidth = 0.8, colour = "black") +
  theme_classic() +
  xlab("Year") +
  ylab("") +
  scale_y_continuous(labels = scales::percent)
```

##  {.unnumbered}

## Conclusions

-   Dog ownership has increased dramatically since 2020, driven significantly by time spent at home during COVID-19 lockdowns[@mayron2022].
-   The proportion of dogs being registered is dropping, while the proportion of dogs classified as menacing has doubled since 2014 and is still increasing.
-   Both the number and proportion of responses relating to attacks on people have dramatically increased since 2020. 
-   The proportion of probationary or disqualified owners is increasing, as are the number of infringements issued, but the number of prosecutions is actually dropping.
-   The number of high priority responses has increased slightly since 2020, while the number of lower priority responses has been falling since 2016.
-   The proportion of known dogs being impounded was dropping up until 2021, but is now increasing.
-   The proportion of impounded dogs claimed/returned to owners, or adopted/rescued, has sharply declined over the last few years, while the proportion of impounded dogs euthanized has sharply risen.
-   The rise in animal management staff has not kept up with the rise in dog numbers over recent years.

## References
