---
title: "Dog Management in Auckland"
author: "Tom Saunders"
output: html_document
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = file.path(dirname(inputFile), 'index.html')) })
---

Under the Dog Control Act 1996 local territorial authorities are responsible for enacting and enforcing bylaws designed to minimise the danger and nuisance caused by dogs to the public. The Act also requires local authorities to report statistics and data relating to dog control activities. Auckland Council operates a regional Animal Management unit and provides data relating to it's activities within [annual reports](https://www.aucklandcouncil.govt.nz/plans-projects-policies-reports-bylaws/our-policies/Pages/policy-on-dogs.aspx). 

I have compiled a dataset relating to dog control taken from these annual reports starting in 2014. The complete dataset, and R code used to perform all the analyses, is available [here](https://github.com/tesaunders/dog-control). 

```{r, echo=FALSE, message=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
```

```{r, echo=FALSE, message=FALSE}
dog_data <- read_csv("data/dog-control.csv")
```

```{r, echo=FALSE}
# Summaries of dogs and owners

dogs <- dog_data |> 
  filter(category == "registrations" | category == "classification") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  select(-dangerous_total, -(starts_with("shelters"))) |> 
  mutate(
    menacing = menacing_33A + menacing_33C,
    dangerous = dangerous_conviction + dangerous_evidence + dangerous_admission,
    pc_men = menacing / dogs_known,
    pc_dan = dangerous / dogs_known,
    pc_reg = dogs_registered / dogs_known,
  )

owners <- dog_data |> 
  filter(subcategory == "owners" | subcategory == "prosecution-appeal") |> 
  group_by(financial_year) |> 
  select(-category) |> 
  pivot_wider(names_from = c(subcategory, measure), values_from = value) |> 
  mutate(
    owners_sanctioned = owners_probationary + owners_disqualified,
    pc_sanctioned = owners_sanctioned / owners_total,
  )
```

## Dogs {.tabset}

### Number of Dogs

The number of known dogs has increased dramatically since 2020.
*The drop in known dog numbers in 2018 reflects work to remove duplicate entries from the register in 2017.

```{r, echo=FALSE}
ggplot(dogs, aes(x = financial_year, y = dogs_known)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Registrations

But the proportion of dogs registered has started to fall sharply since 2020.
*Investigate blip in registrations in 2017

```{r, echo=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_reg)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Menacing Dogs

Meanwhile, the proportion of known dogs classified as menacing has more than doubled since 2014.

```{r, echo=FALSE}
ggplot(dogs, aes(x = financial_year, y = pc_men)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

## {-}

## Owners {.tabset}

### Number of Owners

```{r, echo=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = owners_total)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Sanctioned Owners

```{r, echo=FALSE, warning=FALSE}
ggplot(owners, aes(x = financial_year, y = pc_sanctioned)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

## {-}

The rise in dog ownership since 2020 has been attributed to the increased time many people spent at home during COVID-19 lockdowns. A nation-wide lockdown was enacted in late March for 2 months, followed by regionalised lockdowns for Auckland in August–September 2020 and February–March 2021. Veterinary de-sexing services were unable to operate...WIP 

While the *number* of sanctioned owners would be expected to rise in line with the increase in owners, it is concerning that the *proportion* of owners classified as probationary or disqualified is also increasing. 

## Responses {.tabset}

### Responses over time

```{r, echo=FALSE}
rfs <- dog_data |> 
  filter(subcategory == "priority-1" | 
           subcategory == "priority-2") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value) |> 
  mutate(
    rfs_total = `priority-1` + `priority-2`,
  )

ggplot(rfs, aes(x = financial_year)) +
  geom_line(aes(y = rfs_total), color = "darkred") +
  geom_line(aes(y = `priority-1`), color = "darkblue") +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

## {-}

## Impounds {.tabset}

```{r, echo=FALSE}
impounds <- dog_data |> 
  filter(category == "shelters") |> 
  group_by(financial_year) |> 
  select(-category, -measure) |> 
  pivot_wider(names_from = c(subcategory), values_from = value)

impounds$dogs_known <- dogs$dogs_known

impounds <- impounds |> 
  mutate(
    pc_impounded = impound / dogs_known,
    pc_returned = `claimed-returned` / impound,
    pc_euthanised = euthanised / impound,
    pc_adopted = `adopted-rescued` / impound,
  )
```

### Impounded Dogs

```{r, echo=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_impounded)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Claimed/Returned to Owner

```{r, echo=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_returned)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Euthanised

```{r, echo=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_euthanised)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

### Adopted/Rescued

```{r, echo=FALSE}
ggplot(impounds, aes(x = financial_year, y = pc_adopted)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```

## {-}

## Enforcement {.tabset}

### Infringement notices - total

### Infringement notices - per owner

### Prosecutions

```{r, echo=FALSE, message=FALSE}
ggplot(owners, aes(x = financial_year, 
                   y = `prosecution-appeal_total`)) +
  geom_line() +
  theme_classic() +
  xlab("Year") +
  ylab("")
```
## {-}

